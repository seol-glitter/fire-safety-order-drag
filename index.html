<!doctype html><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>ìˆœì„œ ë“œë˜ê·¸ â€“ ì´ˆì´ˆê²½ëŸ‰(ì›¹P) v4</title>
<style>
*{box-sizing:border-box}html,body{height:100%;margin:0}body{font-family:system-ui,'Noto Sans KR',sans-serif;background:#000}
.stage{position:fixed;inset:0;overflow:hidden;user-select:none;-webkit-user-select:none;background:#000}
#bg{position:absolute;inset:0;width:100vw;height:100vh;object-fit:contain}
.slotimg{position:absolute;width:14%;pointer-events:none}
.cardimg{position:absolute;width:18%;touch-action:none;cursor:grab;border-radius:10px;box-shadow:0 3px 8px rgba(0,0,0,.18);transition:transform .12s}
#card1{width:9%} /* ë©ˆì¶°ìš” ë” ì‘ê²Œ */
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.55);display:flex;align-items:center;justify-content:center;visibility:hidden;opacity:0;transition:.2s}
.modal{background:#fff;border-radius:14px;padding:18px 16px;max-width:420px;width:92%;text-align:center;box-shadow:0 10px 30px rgba(0,0,0,.35)}
.modal h2{margin:0 0 8px} .modal p{color:#555;margin:0 0 14px}
.btn{appearance:none;border:1px solid #d0d0d0;background:#fff;border-radius:10px;padding:10px 14px;font-weight:600;cursor:pointer}
.btn.primary{background:#111;color:#fff;border-color:#111}
.actions{display:flex;gap:10px;justify-content:center;flex-wrap:wrap}
.show{visibility:visible;opacity:1}
.homeBtn{position:fixed;right:12px;top:12px;z-index:5;display:none}
@keyframes shake{0%{transform:translateX(0)}25%{transform:translateX(-6px)}50%{transform:translateX(6px)}75%{transform:translateX(-4px)}100%{transform:translateX(0)}}
.shake{animation:shake .25s}
</style>
<div class="stage">
  <img id="bg" src="assets/bg.webp" alt="ë°°ê²½">
  <!-- ìˆ«ì(ë“œë¡­ì¡´) -->
  <img id="slot1" class="slotimg" src="assets/1ë²ˆì¡´.webp" alt="1">
  <img id="slot2" class="slotimg" src="assets/2ë²ˆì¡´.webp" alt="2">
  <img id="slot3" class="slotimg" src="assets/3ë²ˆì¡´.webp" alt="3">
  <!-- ì¹´ë“œ(ì„ì–´ì„œ: ë§¨ìœ„=êµ´ëŸ¬ìš”_2, ì¤‘ê°„=ì—ë“œë ¤ìš”, ë§¨ì•„ë˜=ë©ˆì¶°ìš”) -->
  <img id="card1" class="cardimg" src="assets/ë©ˆì¶°ìš”.webp" alt="ë©ˆì¶°ìš”">
  <img id="card2" class="cardimg" src="assets/ì—ë“œë ¤ìš”.webp" alt="ì—ë“œë ¤ìš”">
  <img id="card3" class="cardimg" src="assets/êµ´ëŸ¬ìš”_2.webp" alt="êµ´ëŸ¬ìš”">
  <button id="home" class="btn homeBtn">ë©”ì¸ìœ¼ë¡œ</button>
  <audio id="ding" src="assets/correct.mp3" preload="auto"></audio>
  <audio id="wrong" src="assets/wrong.mp3" preload="auto"></audio>
</div>
<div id="success" class="overlay">
  <div class="modal">
    <h2>ì •ë‹µì…ë‹ˆë‹¤! ğŸ‰</h2>
    <p>3ê°€ì§€ ëª¨ë‘ ì œ ìë¦¬ì— ë“œë¡­í–ˆì–´ìš”.</p>
    <div class="actions">
      <button id="retry" class="btn">ë‹¤ì‹œí•˜ê¸°</button>
      <button id="goHome" class="btn primary">ë©”ì¸ìœ¼ë¡œ</button>
    </div>
  </div>
</div>
<script>
const HOME_URL = "https://sites.google.com/d/1pJid-ehWdJbYdYYEBRKQqDqrH3lOS0Sk/p/1Kvy4WXllV3SOZQeztIv_5nzOxWq_7aTI/edit";
const SLOTS=[
  {id:'slot1', left:78, top:12, width:12},
  {id:'slot2', left:78, top:42, width:12},
  {id:'slot3', left:78, top:72, width:12},
];
const STARTS=[
  {id:'card3', left:6, top:12},
  {id:'card2', left:6, top:42},
  {id:'card1', left:6, top:72},
];
const MAP={ card1:'slot1', card2:'slot2', card3:'slot3' };

const bg=document.getElementById('bg'), ding=document.getElementById('ding'), wrong=document.getElementById('wrong');
const success=document.getElementById('success'), retry=document.getElementById('retry');
const homeBtn=document.getElementById('home'), goHome=document.getElementById('goHome');

function pct(v,t){return v/100*t}
function layout(){
  const r=bg.getBoundingClientRect();
  SLOTS.forEach(s=>{ const el=document.getElementById(s.id);
    const nw=el.naturalWidth||100, nh=el.naturalHeight||100;
    const w=pct(s.width,r.width), h=w*(nh/nw);
    el.style.width=w+'px'; el.style.left=(r.left+pct(s.left,r.width))+'px'; el.style.top=(r.top+pct(s.top,r.height))+'px';
  });
  STARTS.forEach(c=>{ const el=document.getElementById(c.id);
    if(!initialPos[c.id]){ initialPos[c.id]={}; }
    const left=(r.left+pct(c.left,r.width)), top=(r.top+pct(c.top,r.height));
    el.style.left=left+'px'; el.style.top=top+'px';
    if(!initialPos[c.id].set){ initialPos[c.id]={x:left,y:top,set:true}; }
  });
}

let drag=null,ox=0,oy=0,placed=new Set(),initialPos={};
function pt(e){return e.touches?{x:e.touches[0].clientX,y:e.touches[0].clientY}:{x:e.clientX,y:e.clientY}}
function down(e){drag=e.currentTarget; const p=pt(e), b=drag.getBoundingClientRect(); ox=p.x-b.left; oy=p.y-b.top; drag.style.cursor='grabbing';}
function move(e){if(!drag)return; const p=pt(e); drag.style.left=(p.x-ox)+'px'; drag.style.top=(p.y-oy)+'px';}
function rect(el){return el.getBoundingClientRect()}
function intersects(a,b){return a.left<b.right && a.right>b.left && a.top<b.bottom && a.bottom>b.top}
function snapTo(el, box){ el.style.left=box.left+'px'; el.style.top=box.top+'px'; }

function up(){ if(!drag)return;
  const targetId=MAP[drag.id];
  const a=rect(drag);
  const targetBox=rect(document.getElementById(targetId));
  // 1) ì •ë‹µ ìŠ¬ë¡¯ì— ë‹¿ì•˜ëŠ”ì§€
  if(intersects(a, targetBox)){
    snapTo(drag, targetBox);
    try{ ding.currentTime=0; ding.play(); }catch(e){}
    placed.add(drag.id); if(placed.size===3) onSuccess();
  }else{
    // 2) ë‹¤ë¥¸ ìŠ¬ë¡¯ì— ë‹¿ì•˜ëŠ”ì§€ ì²´í¬ â†’ í‹€ë¦¼ íš¨ê³¼
    const otherHit = ['slot1','slot2','slot3'].some(id=> id!==targetId && intersects(a, rect(document.getElementById(id))));
    if(otherHit){
      // í‹€ë¦¼ ì‚¬ìš´ë“œ + ì‚´ì§ í”ë“¤ê¸° + ì›ìœ„ì¹˜ ë³µê·€
      drag.classList.add('shake');
      setTimeout(()=>drag.classList.remove('shake'), 300);
      try{ wrong.currentTime=0; wrong.play(); }catch(e){}
      const init = initialPos[drag.id];
      if(init){ drag.style.left=init.x+'px'; drag.style.top=init.y+'px'; }
    }
    // ìŠ¬ë¡¯ì— ë‹¿ì§€ ì•Šìœ¼ë©´ ì•„ë¬´ ê²ƒë„ í•˜ì§€ ì•ŠìŒ(ììœ  ìœ„ì¹˜ ìœ ì§€)
  }
  drag.style.cursor='grab'; drag=null;
}

function onSuccess(){ success.classList.add('show'); homeBtn.style.display='block'; }
function resetGame(){ placed.clear(); success.classList.remove('show'); Object.keys(initialPos).forEach(id=>{ const el=document.getElementById(id); const p=initialPos[id]; el.style.left=p.x+'px'; el.style.top=p.y+'px'; }); }

function goHomeNow(){ try{ window.top.location.href = HOME_URL; }catch(e){ location.href = HOME_URL; } }

['card1','card2','card3'].forEach(id=>{ const el=document.getElementById(id);
  el.addEventListener('mousedown',down); window.addEventListener('mousemove',move); window.addEventListener('mouseup',up);
  el.addEventListener('touchstart',e=>{e.preventDefault();down(e)});
  window.addEventListener('touchmove',e=>{e.preventDefault();move(e)},{passive:false});
  window.addEventListener('touchend',up);
});
retry.onclick=resetGame; goHome.onclick=goHomeNow; homeBtn.onclick=goHomeNow;

window.addEventListener('resize',layout);
bg.addEventListener('load',layout);
Promise.all(Array.from(document.querySelectorAll('.slotimg')).map(img=>new Promise(res=>{ if(img.complete) return res(); img.onload=res; img.onerror=res; }))).then(layout);
layout();
</script>
